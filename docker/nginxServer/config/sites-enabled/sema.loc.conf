server {
	listen 80;
	listen [::]:80;
	listen 9000;


	server_name sema.loc;

	root /var/www/semafor/public;

	if ($bad_bot) {
		return 403;
	}

	# Logging
	access_log /var/log/nginx/sema.loc.access.log basic if=$excluded_logs;
	error_log /var/log/nginx/sema.loc.error.log warn;

	location ~ ^/(static) {
		root /var/www/semafor/public;
	}

	location ~ ^/((?!\/).)+\.(css|txt|js|ico|png|jpg|jpeg|json) {
		expires 7d;
		access_log off;
		root /var/www/semafor/public;
	}

	location ~ ^/api {
		content_by_lua_file /etc/nginx/lua/api.lua;
	}

	location ~ ^/cms {
		content_by_lua_file /etc/nginx/lua/cms.lua;
	}

	location ~ ^/media {
		proxy_pass http://77.89.200.54:8003;
		proxy_cache STATIC;
		proxy_cache_valid any 48h;
	}

	location ~ ^/ {
		content_by_lua_file /etc/nginx/lua/node.lua;
	}
}
